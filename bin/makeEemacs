#!/bin/sh

case `uname -m` in
    i686)
    EMACS="setarch i386 -R `which emacs`"
    ;;
    x86_64)
    EMACS=`which emacs`
    ;;
esac

rm -rf ~/bin/eemacs

(cd ~/.emacs.d/lisp && make)
(cd ~/.emacs.d/my-lisp && make)

echo ";; Automatically generated by makeEemacs" > init-eemacs.el
echo ";; Automatically generated by makeEemacs" > load-eemacs.el

grep "init-eemacs" ~/.emacs.d/qinit.el >> init-eemacs.el
grep "init-eemacs" ~/.emacs.d/init.el >> init-eemacs.el
grep -v "init-eemacs" ~/.emacs.d/init.el >> load-eemacs.el

make

$EMACS --batch -q \
    --load load-eemacs.el \
    --execute "(dump-emacs \"~/bin/eemacs\" \"$EMACS\")"

bin/makeTAGS
