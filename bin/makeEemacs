#!/bin/sh

EMACS=`which emacs`

if which setarch >& /dev/null
then
case `uname -m` in
    i686)
    EMACS="setarch i386 -R `which emacs`"
    ;;
    x86_64)
    EMACS="setarch x86_64 -R `which emacs`"
    ;;
esac
fi

rm -rf ~/bin/eemacs

(cd ~/.emacs.d/lisp && make)
(cd ~/.emacs.d/my-lisp && make)

echo ";; Automatically generated by makeEemacs" > init-eemacs.el
echo ";; Automatically generated by makeEemacs" > load-eemacs.el

grep "init-eemacs" ~/.emacs.d/qinit.el >> init-eemacs.el
grep "init-eemacs" ~/.emacs.d/init.el >> init-eemacs.el
grep -v "init-eemacs" ~/.emacs.d/init.el >> load-eemacs.el

make

$EMACS --batch -q \
    --load load-eemacs.el \
    --execute "(dump-emacs \"~/bin/linux/eemacs\" \"`which emacs`\")"

bin/makeTAGS
