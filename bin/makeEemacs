#!/bin/bash

EMACS=`which emacs`

if which setarch >& /dev/null
then
case `uname -m` in
    i686)
    EMACS="setarch i386 -R `which emacs`"
    ;;
    x86_64)
    EMACS="setarch x86_64 -R `which emacs`"
    ;;
esac
fi

rm -rf ~/bin/linux/eemacs

echo ";; Automatically generated by makeEemacs" > init-eemacs.el
echo ";; Automatically generated by makeEemacs" > load-eemacs.el
sed -f bin/sedLoadPath init.el >> init-eemacs.el
find init -name "*.el" -exec sed -f bin/sedLoadPath {} \; >> init-eemacs.el
grep "init-eemacs" ~/.emacs.d/init/qinit.el >> init-eemacs.el
grep "init-eemacs" ~/.emacs.d/init.el >> init-eemacs.el
grep -v "init-eemacs" ~/.emacs.d/init.el >> load-eemacs.el

make

/usr/local/src/emacs/src/temacs  --eval "(setq delete-old-versions t)" --batch -q  \
    --load load-eemacs.el \
    --execute "(setq command-line-processed nil)" \
    --execute "(dump-emacs \"~/bin/linux/eemacs\" \"`which emacs`\")"

bin/makeTAGS
